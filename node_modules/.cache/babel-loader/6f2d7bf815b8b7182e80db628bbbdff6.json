{"ast":null,"code":"var _jsxFileName = \"/home/gustazacchi/gestao-de-habitos/src/pages/MyAcount/index.js\",\n    _s = $RefreshSig$();\n\nimport Input from \"../../components/Input\";\nimport { Container, AnimationContainer, Button } from \"./styles\";\nimport { FiUser, FiVoicemail, FiLock } from \"react-icons/fi\";\nimport * as yup from 'yup';\nimport { useForm } from \"react-hook-form\";\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport api from \"../../services/api\";\nimport { toast } from 'react-toastify';\nimport jwt_decode from \"jwt-decode\";\nimport { useEffect, useState } from 'react';\nimport { Redirect, useHistory } from \"react-router\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst MyAcount = () => {\n  _s();\n\n  var _errors$username, _errors$password, _errors$username2;\n\n  const history = useHistory();\n  const [token, setToken] = useState(null);\n  const [success, setSuccess] = useState(false);\n  const [usuario, setUsuario] = useState('');\n  const [decode, setDecode] = useState('');\n\n  const getToken = () => {\n    const localToken = JSON.parse(localStorage.getItem('@GestãoDeHábitos:access'));\n    api.defaults.headers.authorization = `Bearer ${localToken}`;\n    setToken(JSON.parse(localStorage.getItem('@GestãoDeHábitos:access')));\n\n    if (token) {\n      setDecode(jwt_decode(JSON.parse(localStorage.getItem('@GestãoDeHábitos:access'))));\n    }\n  };\n\n  const forSchema = yup.object().shape({\n    usernameAtual: yup.string(),\n    username: yup.string(),\n    password: yup.string()\n  });\n  const {\n    register,\n    handleSubmit,\n    formState: {\n      errors\n    }\n  } = useForm({\n    resolver: yupResolver(forSchema)\n  }); // const handleSubmitConfirm = (data) => {\n  //     var confirm = {username:`${data.username}`, password:`${data.password}`}\n  //     console.log(confirm)\n  //     api.post(\"/sessions/\", confirm)\n  //     .then((response)=> {\n  //         const {access} = response.confirm\n  //         localStorage.setItem(\"@GestãoDeHábitos:access\", JSON.stringify(access))\n  //     })\n  //     .catch((err) => toast.error('Password or User Incorrect'))        \n  // }\n\n  const handleSubmitFunction = data => {\n    var confirm = {\n      username: `${data.usernameAtual}`,\n      password: `${data.pass}`\n    };\n    api.post(\"/sessions/\", confirm).then(() => {\n      setSuccess(true);\n      toast.success('Password and User Correct');\n    }).catch(err => toast.error('Password or User Incorrect'));\n\n    if (success) {\n      if (token) {\n        setSuccess(false);\n        api.patch(`/users/${decode.user_id}/`, data, {\n          Authorization: `Bearer ${token}`\n        }).then(() => {\n          toast.success(`Your Username Is ${data.username}`);\n        }).then(() => submitFunction()).catch(err => toast.error('User Already Exists'));\n      } else {\n        return setSuccess(false);\n      }\n    }\n  };\n\n  const submitFunction = () => {\n    if (token) {\n      var decode = jwt_decode(token);\n      api.get(`/users/${decode.user_id}/`).then(response => setUsuario(response.data)).catch(err => console.log('Erro ao exibir usuário'));\n    }\n  };\n\n  useEffect(() => {\n    getToken();\n    submitFunction();\n  }, [token]);\n  const tok = JSON.parse(localStorage.getItem(\"@GestãoDeHábitos:access\")) || \"\";\n\n  if (!tok) {\n    return /*#__PURE__*/_jsxDEV(Redirect, {\n      to: \"/login\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 20\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Change User\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(AnimationContainer, {\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(handleSubmitFunction),\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Username: \", /*#__PURE__*/_jsxDEV(\"a\", {\n            children: usuario.username\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 34\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Email: \", /*#__PURE__*/_jsxDEV(\"a\", {\n            children: usuario.email\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 31\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: handleSubmit(),\n          children: [/*#__PURE__*/_jsxDEV(Input, {\n            register: register,\n            name: \"usernameAtual\",\n            icon: FiUser,\n            placeholder: \"Your Username\",\n            error: (_errors$username = errors.username) === null || _errors$username === void 0 ? void 0 : _errors$username.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            register: register,\n            name: \"pass\",\n            icon: FiLock,\n            placeholder: \"Your Password\",\n            type: \"password\",\n            error: (_errors$password = errors.password) === null || _errors$password === void 0 ? void 0 : _errors$password.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          register: register,\n          name: \"username\",\n          icon: FiUser,\n          placeholder: \"Your New Username\",\n          error: (_errors$username2 = errors.username) === null || _errors$username2 === void 0 ? void 0 : _errors$username2.message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          type: \"submit\",\n          size: '100%',\n          children: \"Change\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          size: '40%',\n          margin: '40px',\n          onClick: () => (localStorage.removeItem('@GestãoDeHábitos:access'), history.push(\"/login\")),\n          children: \"Logout\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 15\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 9\n  }, this);\n};\n\n_s(MyAcount, \"VXFC9h9SauTSOMAhi+zISwKjy6g=\", false, function () {\n  return [useHistory, useForm];\n});\n\n_c = MyAcount;\nexport default MyAcount;\n\nvar _c;\n\n$RefreshReg$(_c, \"MyAcount\");","map":{"version":3,"sources":["/home/gustazacchi/gestao-de-habitos/src/pages/MyAcount/index.js"],"names":["Input","Container","AnimationContainer","Button","FiUser","FiVoicemail","FiLock","yup","useForm","yupResolver","api","toast","jwt_decode","useEffect","useState","Redirect","useHistory","MyAcount","history","token","setToken","success","setSuccess","usuario","setUsuario","decode","setDecode","getToken","localToken","JSON","parse","localStorage","getItem","defaults","headers","authorization","forSchema","object","shape","usernameAtual","string","username","password","register","handleSubmit","formState","errors","resolver","handleSubmitFunction","data","confirm","pass","post","then","catch","err","error","patch","user_id","Authorization","submitFunction","get","response","console","log","tok","email","message","removeItem","push"],"mappings":"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","sourcesContent":["import Input from \"../../components/Input\"\nimport {Container,AnimationContainer, Button} from \"./styles\"\nimport {FiUser, FiVoicemail, FiLock} from \"react-icons/fi\"\nimport * as yup from 'yup';\nimport { useForm } from \"react-hook-form\";\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport api from \"../../services/api\"\nimport{ toast } from 'react-toastify'\nimport jwt_decode from \"jwt-decode\"\nimport { useEffect,useState} from 'react'\nimport { Redirect, useHistory } from \"react-router\";\n\nconst MyAcount = () => {\n    const history = useHistory()\n    const [token, setToken] = useState(null)\n    const [success, setSuccess] = useState(false)\n    const [usuario, setUsuario] = useState('')\n    const [decode, setDecode] = useState('')\n    \n\n    const getToken = () => {\n        const localToken = JSON.parse(localStorage.getItem('@GestãoDeHábitos:access'))\n        api.defaults.headers.authorization = `Bearer ${localToken}`;\n        setToken(JSON.parse(localStorage.getItem('@GestãoDeHábitos:access')))\n        if (token) {\n            setDecode(jwt_decode(JSON.parse(localStorage.getItem('@GestãoDeHábitos:access'))))\n        }\n    }\n    const forSchema = yup.object().shape({\n        usernameAtual: yup.string(),\n        username: yup.string(),\n        password: yup.string(),\n      })\n    const{register, handleSubmit, formState:{errors}} = useForm({\n        resolver: yupResolver(forSchema)\n    });  \n    // const handleSubmitConfirm = (data) => {\n    //     var confirm = {username:`${data.username}`, password:`${data.password}`}\n    //     console.log(confirm)\n        \n    //     api.post(\"/sessions/\", confirm)\n    //     .then((response)=> {\n    //         const {access} = response.confirm\n    //         localStorage.setItem(\"@GestãoDeHábitos:access\", JSON.stringify(access))\n    //     })\n    //     .catch((err) => toast.error('Password or User Incorrect'))        \n    // }\n    const handleSubmitFunction = (data) => {\n        var confirm = {username:`${data.usernameAtual}`, password:`${data.pass}`}\n\n        api.post(\"/sessions/\", confirm)\n        .then(()=> {\n            setSuccess(true)\n            toast.success('Password and User Correct')\n        })\n        .catch((err) => toast.error('Password or User Incorrect'))  \n\n        if(success){\n            if(token){\n                setSuccess(false)\n                api.patch(`/users/${decode.user_id}/`, data, {Authorization: `Bearer ${token}`})\n                .then(()=> {toast.success(`Your Username Is ${data.username}`)})\n                .then(()=>submitFunction())\n                .catch((err) => toast.error('User Already Exists'))\n            }else{return setSuccess(false)}\n        }\n        \n    }\n    const submitFunction = () => {\n        if(token){\n            var decode = jwt_decode(token)\n            api.get(`/users/${decode.user_id}/`)\n            .then((response)=> setUsuario(response.data))\n            .catch((err) => console.log('Erro ao exibir usuário'))\n        }   \n    }\n    useEffect(() => {\n        getToken()\n        submitFunction()\n        }\n        ,[token])\n\n        const tok = JSON.parse(localStorage.getItem(\"@GestãoDeHábitos:access\")) || \"\";\n        if(!tok){\n            return <Redirect to=\"/login\"/>\n        }\n\n\n    return(\n        <Container>\n            <h1>Change User</h1>\n            <AnimationContainer>\n              <form onSubmit={handleSubmit(handleSubmitFunction)}>\n                    <p>Username: <a>{usuario.username}</a></p>\n                    <p>Email: <a>{usuario.email}</a></p>\n                    <form onSubmit={handleSubmit()}>\n                        <Input register={register} name=\"usernameAtual\" icon={FiUser} placeholder=\"Your Username\" error={errors.username?.message}/>\n                        <Input register={register} name=\"pass\" icon={FiLock} placeholder=\"Your Password\" type=\"password\" error={errors.password?.message}/>\n                    </form>\n                    <Input register={register} name=\"username\" icon={FiUser} placeholder=\"Your New Username\" error={errors.username?.message}/>\n                    <Button type=\"submit\" size={'100%'}>Change</Button>\n                    <Button size={'40%'} margin={'40px'} onClick={()=>(localStorage.removeItem('@GestãoDeHábitos:access'), history.push(\"/login\"))} >Logout</Button>\n              </form>\n            </AnimationContainer>\n            \n        </Container>\n    )\n}\nexport default MyAcount\n"]},"metadata":{},"sourceType":"module"}