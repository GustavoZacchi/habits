{"ast":null,"code":"var _jsxFileName = \"/home/gustazacchi/gestao-de-habitos/src/pages/MyAcount/index.js\",\n    _s = $RefreshSig$();\n\nimport Input from \"../../components/Input\";\nimport { Container, AnimationContainer, Button } from \"./styles\";\nimport { FiUser, FiVoicemail, FiLock } from \"react-icons/fi\";\nimport * as yup from 'yup';\nimport { useForm } from \"react-hook-form\";\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport api from \"../../services/api\";\nimport { toast } from 'react-toastify';\nimport jwt_decode from \"jwt-decode\";\nimport { useEffect, useState } from 'react';\nimport { Redirect, useHistory } from \"react-router\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst MyAcount = () => {\n  _s();\n\n  var _errors$username, _errors$password, _errors$username2;\n\n  const history = useHistory();\n  const [token, setToken] = useState(null);\n  const [usuario, setUsuario] = useState('');\n  const [decode, setDecode] = useState('');\n\n  const getToken = () => {\n    const localToken = JSON.parse(localStorage.getItem('@GestãoDeHábitos:access'));\n    api.defaults.headers.authorization = `Bearer ${localToken}`;\n    setToken(JSON.parse(localStorage.getItem('@GestãoDeHábitos:access')));\n\n    if (token) {\n      setDecode(jwt_decode(JSON.parse(localStorage.getItem('@GestãoDeHábitos:access'))));\n    }\n  };\n\n  const forSchema = yup.object().shape({\n    usernameAtual: yup.string(),\n    username: yup.string(),\n    password: yup.string()\n  });\n  const {\n    register,\n    handleSubmit,\n    formState: {\n      errors\n    }\n  } = useForm({\n    resolver: yupResolver(forSchema)\n  });\n\n  const handleSubmitFunction = data => {\n    if (!data.username) {\n      console.log(data);\n      data.username = usuario.username;\n    }\n\n    var confirm = {\n      username: `${data.username}`,\n      password: `${data.password}`\n    };\n    console.log(confirm);\n    api.post(\"/sessions/\", confirm).then(response => {\n      const {\n        access\n      } = response.confirm;\n      localStorage.setItem(\"@GestãoDeHábitos:access\", JSON.stringify(access));\n    }).catch(err => toast.error('Password or User Incorrect'));\n\n    if (token) {\n      api.patch(`/users/${decode.user_id}/`, data, {\n        Authorization: `Bearer ${token}`\n      }).then(() => {\n        toast.success(`Your Username Is ${data.username}`);\n      }).then(() => submitFunction()).catch(err => toast.error('Error Editing User'));\n    } else {\n      return;\n    }\n  };\n\n  const submitFunction = () => {\n    if (token) {\n      var decode = jwt_decode(token);\n      api.get(`/users/${decode.user_id}/`).then(response => setUsuario(response.data)).catch(err => console.log('Erro ao exibir usuário'));\n    }\n  };\n\n  useEffect(() => {\n    getToken();\n    submitFunction();\n  }, [token]);\n  const tok = JSON.parse(localStorage.getItem(\"@GestãoDeHábitos:access\")) || \"\";\n\n  if (!tok) {\n    return /*#__PURE__*/_jsxDEV(Redirect, {\n      to: \"/login\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 20\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Change User\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(AnimationContainer, {\n      children: /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(handleSubmitFunction),\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Username: \", /*#__PURE__*/_jsxDEV(\"a\", {\n            children: usuario.username\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 34\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Email: \", /*#__PURE__*/_jsxDEV(\"a\", {\n            children: usuario.email\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 31\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          register: register,\n          name: \"usernameAtual\",\n          icon: FiUser,\n          placeholder: \"Your Username\",\n          error: (_errors$username = errors.username) === null || _errors$username === void 0 ? void 0 : _errors$username.message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          register: register,\n          name: \"password\",\n          icon: FiLock,\n          placeholder: \"Your Password\",\n          type: \"password\",\n          error: (_errors$password = errors.password) === null || _errors$password === void 0 ? void 0 : _errors$password.message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          register: register,\n          name: \"username\",\n          icon: FiUser,\n          placeholder: \"Your New Username\",\n          error: (_errors$username2 = errors.username) === null || _errors$username2 === void 0 ? void 0 : _errors$username2.message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          type: \"submit\",\n          size: '100%',\n          children: \"Change\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          size: '40%',\n          margin: '40px',\n          onClick: () => (localStorage.removeItem('@GestãoDeHábitos:access'), history.push(\"/login\")),\n          children: \"Logout\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 15\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 81,\n    columnNumber: 9\n  }, this);\n};\n\n_s(MyAcount, \"/46IPosBxmvhpAVVwcvNh+TSKr0=\", false, function () {\n  return [useHistory, useForm];\n});\n\n_c = MyAcount;\nexport default MyAcount;\n\nvar _c;\n\n$RefreshReg$(_c, \"MyAcount\");","map":{"version":3,"sources":["/home/gustazacchi/gestao-de-habitos/src/pages/MyAcount/index.js"],"names":["Input","Container","AnimationContainer","Button","FiUser","FiVoicemail","FiLock","yup","useForm","yupResolver","api","toast","jwt_decode","useEffect","useState","Redirect","useHistory","MyAcount","history","token","setToken","usuario","setUsuario","decode","setDecode","getToken","localToken","JSON","parse","localStorage","getItem","defaults","headers","authorization","forSchema","object","shape","usernameAtual","string","username","password","register","handleSubmit","formState","errors","resolver","handleSubmitFunction","data","console","log","confirm","post","then","response","access","setItem","stringify","catch","err","error","patch","user_id","Authorization","success","submitFunction","get","tok","email","message","removeItem","push"],"mappings":"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","sourcesContent":["import Input from \"../../components/Input\"\nimport {Container,AnimationContainer, Button} from \"./styles\"\nimport {FiUser, FiVoicemail, FiLock} from \"react-icons/fi\"\nimport * as yup from 'yup';\nimport { useForm } from \"react-hook-form\";\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport api from \"../../services/api\"\nimport{ toast } from 'react-toastify'\nimport jwt_decode from \"jwt-decode\"\nimport { useEffect,useState} from 'react'\nimport { Redirect, useHistory } from \"react-router\";\n\nconst MyAcount = () => {\n    const history = useHistory()\n    const [token, setToken] = useState(null)\n    const [usuario, setUsuario] = useState('')\n    const [decode, setDecode] = useState('')\n    \n\n    const getToken = () => {\n        const localToken = JSON.parse(localStorage.getItem('@GestãoDeHábitos:access'))\n        api.defaults.headers.authorization = `Bearer ${localToken}`;\n        setToken(JSON.parse(localStorage.getItem('@GestãoDeHábitos:access')))\n        if (token) {\n            setDecode(jwt_decode(JSON.parse(localStorage.getItem('@GestãoDeHábitos:access'))))\n        }\n    }\n    const forSchema = yup.object().shape({\n        usernameAtual: yup.string(),\n        username: yup.string(),\n        password: yup.string(),\n      })\n    const{register, handleSubmit, formState:{errors}} = useForm({\n        resolver: yupResolver(forSchema)\n    });  \n    \n    const handleSubmitFunction = (data) => {\n        if(!data.username){\n            console.log(data)\n            data.username=usuario.username \n        }\n        var confirm = {username:`${data.username}`, password:`${data.password}`}\n        console.log(confirm)\n        \n        api.post(\"/sessions/\", confirm)\n        .then((response)=> {\n            const {access} = response.confirm\n            localStorage.setItem(\"@GestãoDeHábitos:access\", JSON.stringify(access))\n        })\n        .catch((err) => toast.error('Password or User Incorrect'))\n\n\n        if(token){\n            api.patch(`/users/${decode.user_id}/`, data, {Authorization: `Bearer ${token}`})\n            .then(()=> {toast.success(`Your Username Is ${data.username}`)})\n            .then(()=>submitFunction())\n            .catch((err) => toast.error('Error Editing User'))\n        }else{return}\n    }\n    const submitFunction = () => {\n        if(token){\n            var decode = jwt_decode(token)\n            api.get(`/users/${decode.user_id}/`)\n            .then((response)=> setUsuario(response.data))\n            .catch((err) => console.log('Erro ao exibir usuário'))\n        }   \n    }\n    useEffect(() => {\n        getToken()\n        submitFunction()\n        }\n        ,[token])\n\n        const tok = JSON.parse(localStorage.getItem(\"@GestãoDeHábitos:access\")) || \"\";\n        if(!tok){\n            return <Redirect to=\"/login\"/>\n        }\n\n\n    return(\n        <Container>\n            <h1>Change User</h1>\n            <AnimationContainer>\n              <form onSubmit={handleSubmit(handleSubmitFunction)}>\n                    <p>Username: <a>{usuario.username}</a></p>\n                    <p>Email: <a>{usuario.email}</a></p>\n                    <Input register={register} name=\"usernameAtual\" icon={FiUser} placeholder=\"Your Username\" error={errors.username?.message}/>\n                    <Input register={register} name=\"password\" icon={FiLock} placeholder=\"Your Password\" type=\"password\" error={errors.password?.message}/>\n                    <Input register={register} name=\"username\" icon={FiUser} placeholder=\"Your New Username\" error={errors.username?.message}/>\n                    <Button type=\"submit\" size={'100%'}>Change</Button>\n                    <Button size={'40%'} margin={'40px'} onClick={()=>(localStorage.removeItem('@GestãoDeHábitos:access'), history.push(\"/login\"))} >Logout</Button>\n              </form>\n            </AnimationContainer>\n            \n        </Container>\n    )\n}\nexport default MyAcount\n"]},"metadata":{},"sourceType":"module"}